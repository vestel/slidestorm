<iframe id="content" src="about:blank" width="100%" height="100%"></iframe>

<script type="text/javascript">
$(document).ready(function(){
        links = new Array();
        refreshRate = <%= @refreshRate %>;
        index=0;
        cdata = 0;
        var active = false;
        var timeout;

        checkJSON();

        function nextLink(){
                document.getElementById('content').src=links[index];
                console.log("Show: "+links[index]);
                index = (index+1) % links.length;
                if (index==0){
                    console.log("Full loop done");
                    links = new Array();
                    checkJSON();
                }
                emergencySwitch();
                timeout = setTimeout(function(){nextLink()}, refreshRate);
        }

        function checkJSON(){
            $.getJSON('active.json', function(data){
                console.log("Data:"+data);
                data.map(function(item){
                    links.push(item.url);
                    console.log("Loaded:"+item.url);
                });
                if (!active) {
                    activate();
                }
            });
        }

        function emergencySwitch(){
            $.getJSON('emergency.json', function(data){
                if (data.value!="0") {
                    location.reload(); 
                }
            });

        }

        function activate(){
            active = true;
            nextLink();
        }

});
</script>
